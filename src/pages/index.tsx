import Head from 'next/head'
import Image from 'next/image'
import { Layout } from '@/components/Layout/Layout'
import { Header } from '@/components/Header/Header'
import { Content } from '@/components/Content/Content'
import { CardList } from '@/components/CardList/CardList'
import { GetServerSideProps, GetServerSidePropsContext, NextPage } from 'next'
import axios from 'axios'
import { useAppSelector } from '@/components/Hooks/useApp'
import { getCookie } from 'cookies-next'
import { ICardProps } from '@/components/CardList/Card/Card'

export const getServerSideProps: GetServerSideProps = async ({ req, res }: GetServerSidePropsContext) => {
  const token = getCookie('token', { req, res })
  if (!token) return {
    props: {postsData: []}
  };
  const {data} = await axios.get('https://oauth.reddit.com/r/all/hot.json?sr_detail=true', {
    headers: { Authorization: `bearer ${token}` },
    params: {
      // limit: 10,
      // after: afterNext,
    }
  })

  // console.log(data)

  return {
    props: {postsData: data.data.children},
  }
}

interface IPost {
  data: ICardProps;
}

export interface IHomePageProps {
  postsData: IPost[]
}

const HomePage: NextPage<IHomePageProps> = ({postsData}) => {
  // console.log(postsData)
  return (
    <>
      <Head>
        <title>Reddit-mirror</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <Layout>
        <Header />
        <Content>
          <CardList postsData={postsData}/>
        </Content>
      </Layout>
    </>
  )
}


export default HomePage
